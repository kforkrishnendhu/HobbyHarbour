@{
    Layout = "_CustomerLayout";
}
@model List<Address>

<div class="container">
    <h2 class="text-center">Manage Addresses</h2>

    <div class="row">
        <div class="col">
            <div class="address-box">
                <div class="actions">
                    <a asp-action="AddAddress" class="btn btn-success mb-3">
                        <i class="fa fa-plus"></i> Add new address
                    </a>
                </div>
            </div>
        </div>
    </div>
    @foreach (var address in Model)
    {
        <div class="row">
            <div class="col">
                <div class="address-box">
                    <p><strong>@address.FullName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@address.PhoneNumber</strong></p>
                    <br />
                    <p>@address.StreetAddress, @address.City, @address.State - @address.PostalCode, @address.Country</p>
                    @Html.AntiForgeryToken()
                    <div class="actions">
                        <a asp-action="EditAddress" asp-route-id="@address.AddressID" class="btn btn-primary">Edit</a>
                        <a href="#" class="btn btn-danger delete-address" data-address-id="@address.AddressID">Delete</a>
                    </div>
                </div>
            </div>
        </div>
    }

</div>

<style>
    .address-box {
        border: 1px solid #ddd;
        padding: 15px;
        margin-bottom: 20px;
        background-color: #e6cfe2;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }

    .actions {
        margin-top: 15px;
    }
</style>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>$(document).ready(function () {
        $(".delete-address").on("click", function (e) {
            e.preventDefault();
            var addressId = $(this).data("address-id");

            // Display a confirmation dialog
            if (confirm("Are you sure you want to delete this address?")) {
                // Generate an anti-forgery token value from the existing token input
                var antiForgeryToken = $("input[name='__RequestVerificationToken']").val();

                // User confirmed, send an AJAX request to delete the address
                $.ajax({
                    method: "POST",
                    url: "/Customer/CustomerAccount/DeleteAddress",
                    data: {
                        id: addressId,
                        __RequestVerificationToken: antiForgeryToken // Include the token in the request data
                    },
                    success: function () {
                        window.location.reload();
                    },
                    error: function (xhr, status, error) {
                        console.log("AJAX error: " + error);
                    }
                });
            }
        });
    });</script>
